<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRS ç§»æ°‘åˆ†æ•°è¯„ä¼° | KOTO Immigration</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #C41E3A; --secondary: #2C3E50; --bg: #F5F7FA; }
        body { margin: 0; font-family: 'Noto Sans SC', sans-serif; background-color: var(--bg); color: #333; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        header { background: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-weight: 700; font-size: 1.2rem; color: var(--secondary); text-decoration: none; }
        .back-link { color: #666; text-decoration: none; font-size: 0.9rem; }

        /* å®¹å™¨ */
        .container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .calc-card { background: white; border-radius: 20px; padding: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--secondary); margin-bottom: 40px; }
        
        /* è¡¨å•åŒºåŸŸ */
        .form-section { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 30px; }
        .form-section:last-child { border-bottom: none; }
        
        /* åŠ¨æ€éšè—åŒºåŸŸ (åŠ¨ç”»æ•ˆæœ) */
        .hidden-section { 
            display: none; 
            background-color: #fff8f8; 
            padding: 20px; 
            border-radius: 10px; 
            margin-top: 15px;
            border: 1px dashed var(--primary);
        }

        label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--secondary); }
        .sub-label { font-size: 0.85rem; color: #666; margin-top: -5px; margin-bottom: 10px; font-weight: normal; }

        select, input {
            width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 8px; font-size: 1rem;
            transition: 0.3s; box-sizing: border-box;
        }
        select:focus, input:focus { border-color: var(--primary); outline: none; }
        
        .ielts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .calc-btn {
            width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 50px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 20px;
        }
        .calc-btn:hover { background: #a0182f; transform: translateY(-2px); }

        #result-area { margin-top: 30px; background: #2C3E50; color: white; padding: 30px; border-radius: 12px; text-align: center; display: none; }
        .score-big { font-size: 3rem; font-weight: bold; color: #FFD700; display: block; margin: 10px 0; }
        
        select:invalid, select option[value=""] { color: #999; } select { color: #333; }
    </style>
</head>
<body>

    <header>
        <a href="/" class="logo">KOTO <span style="color:var(--primary)">IMMIGRATION</span></a>
        <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
    </header>

    <div class="container">
        <div class="calc-card">
            <h1>Express Entry ç§»æ°‘åˆ†æ•°è‡ªæµ‹</h1>
            
            <div class="form-section">
                <label>1. å©šå§»çŠ¶å†µ (Marital Status)</label>
                <select id="marital-status" onchange="toggleSpouseQ()" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„å©šå§»çŠ¶å†µ...</option>
                    <option value="single">å•èº« / ç¦»å¼‚ / ä¸§å¶ (Single)</option>
                    <option value="married">å·²å©š / åŒå±…ä¼´ä¾£ (Married / Common-law)</option>
                </select>

                <div id="spouse-citizen-box" class="hidden-section">
                    <label>æ‚¨çš„é…å¶æ˜¯åŠ æ‹¿å¤§å…¬æ°‘æˆ–æ°¸ä¹…å±…æ°‘å—ï¼Ÿ</label>
                    <div class="sub-label">* å¦‚æœé€‰â€œæ˜¯â€ï¼Œæ‚¨çš„ç®—åˆ†è§„åˆ™å°†æŒ‰â€œå•èº«â€æ ‡å‡†è®¡ç®—ï¼ˆåˆ†æ•°æ›´é«˜ï¼‰ã€‚</div>
                    <select id="spouse-citizen" onchange="checkScoreMode()">
                        <option value="" disabled selected>è¯·é€‰æ‹©...</option>
                        <option value="yes">æ˜¯ (é…å¶æ˜¯åŠ æ‹¿å¤§äºº)</option>
                        <option value="no">å¦ (é…å¶å°†éšè¡Œç§»æ°‘)</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <label>2. æ‚¨çš„å¹´é¾„</label>
                <select id="age" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„å¹´é¾„åŒºé—´...</option>
                    <option value="12">18-29å² (é»„é‡‘å¹´é¾„)</option>
                    <option value="11">30å²</option>
                    <option value="10">31å²</option>
                    <option value="9">32å²</option>
                    <option value="8">33å²</option>
                    <option value="7">34å²</option>
                    <option value="6">35å²</option>
                    <option value="5">36å²</option>
                    <option value="4">37å²</option>
                    <option value="3">38å²</option>
                    <option value="2">39å²</option>
                    <option value="1">40-44å²</option>
                    <option value="0">45å²åŠä»¥ä¸Š</option>
                </select>
            </div>

            <div class="form-section">
                <label>3. æœ€é«˜å­¦å†</label>
                <select id="education" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©æœ€é«˜å­¦å†...</option>
                    <option value="phd">åšå£«å­¦ä½ (PhD)</option>
                    <option value="master">ç¡•å£«å­¦ä½ (Master's)</option>
                    <option value="two-certs">åŒå­¦å† (å…¶ä¸­ä¸€ä¸ªä¸º3å¹´ä»¥ä¸Š)</option>
                    <option value="bachelor">æœ¬ç§‘ (3å¹´ä»¥ä¸Š) / 3å¹´å¤§ä¸“</option>
                    <option value="2yr">2å¹´å¤§ä¸“/æ–‡å‡­</option>
                    <option value="1yr">1å¹´å¤§ä¸“/æ–‡å‡­</option>
                    <option value="hs">é«˜ä¸­æ¯•ä¸š</option>
                </select>
            </div>

            <div class="form-section">
                <label>4. é›…æ€ Gç±»æˆç»© (IELTS General)</label>
                <div class="ielts-grid">
                    <div><input type="number" id="ielts-l" step="0.5" min="0" placeholder="å¬åŠ› (Listening)" oninput="if(value<0)value=0"></div>
                    <div><input type="number" id="ielts-r" step="0.5" min="0" placeholder="é˜…è¯» (Reading)" oninput="if(value<0)value=0"></div>
                    <div><input type="number" id="ielts-w" step="0.5" min="0" placeholder="å†™ä½œ (Writing)" oninput="if(value<0)value=0"></div>
                    <div><input type="number" id="ielts-s" step="0.5" min="0" placeholder="å£è¯­ (Speaking)" oninput="if(value<0)value=0"></div>
                </div>
            </div>

            <div class="form-section">
                <label>5. åŠ æ‹¿å¤§æœ¬åœ°å·¥ä½œç»éªŒ</label>
                <select id="can-exp" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©å¹´é™...</option>
                    <option value="0">æ—  / ä¸æ»¡1å¹´</option>
                    <option value="1">1å¹´</option>
                    <option value="2">2å¹´</option>
                    <option value="3">3å¹´</option>
                    <option value="4">4å¹´</option>
                    <option value="5">5å¹´åŠä»¥ä¸Š</option>
                </select>
            </div>

            <div class="form-section">
                <label>6. æµ·å¤–(ä¸­å›½)å·¥ä½œç»éªŒ</label>
                <select id="foreign-exp" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©å¹´é™...</option>
                    <option value="0">æ—  / ä¸æ»¡1å¹´</option>
                    <option value="1">1-2å¹´</option>
                    <option value="3">3å¹´åŠä»¥ä¸Š</option>
                </select>
            </div>

            <button class="calc-btn" onclick="calculateCRS()">æŸ¥çœ‹æˆ‘çš„åˆ†æ•°</button>

            <div id="result-area">
                <p>æ‚¨çš„ CRS é¢„ä¼°æ€»åˆ†</p>
                <span class="score-big" id="total-score">0</span>
                <p id="status-display" style="font-size:0.9rem; color:#ccc;">(åŸºäºå•èº«/é…å¶ä¸éšè¡Œæ ‡å‡†)</p>
                <p id="score-advice" style="opacity: 0.9; margin-top: 15px;">...</p>
            </div>

        </div>
    </div>

    <script>
        // 1. ç•Œé¢è”åŠ¨é€»è¾‘
        function toggleSpouseQ() {
            var status = document.getElementById("marital-status").value;
            var box = document.getElementById("spouse-citizen-box");
            if (status === "married") {
                box.style.display = "block"; // æ˜¾ç¤ºç¬¬äºŒä¸ªé—®é¢˜
                box.style.animation = "fadeIn 0.5s";
            } else {
                box.style.display = "none";
                document.getElementById("spouse-citizen").value = ""; // é‡ç½®é€‰é¡¹
            }
        }

        // 2. åˆ¤æ–­æ˜¯å¦è§†ä¸ºâ€œå•èº«â€è®¡ç®— (isSingleStatus)
        // è§„åˆ™ï¼šå•èº« OR å·²å©šä½†é…å¶æ˜¯åŠ æ‹¿å¤§äºº = å•èº«åˆ†å€¼è¡¨
        //      å·²å©šä¸”é…å¶ä¸éšè¡Œ(æˆ–éå…¬æ°‘) = å·²å©šåˆ†å€¼è¡¨ (ç¨å¾®ä½ä¸€ç‚¹ï¼Œå› ä¸ºæœ‰é…å¶åŠ åˆ†é¡¹ï¼Œè¿™é‡Œç®€åŒ–ä¸ºä¸»ç”³å¾—åˆ†)
        function getIsSingle() {
            var mStatus = document.getElementById("marital-status").value;
            var spCitizen = document.getElementById("spouse-citizen").value;
            
            // å¦‚æœæ˜¯å•èº« -> True
            if (mStatus === "single") return true;
            // å¦‚æœæ˜¯å·²å©šï¼Œä½†é…å¶æ˜¯åŠ æ‹¿å¤§äºº -> True
            if (mStatus === "married" && spCitizen === "yes") return true;
            // å…¶ä»–æƒ…å†µ (å·²å©šä¸”é…å¶éå…¬æ°‘) -> False (ä½¿ç”¨Category B - å·²å©šæ‰“åˆ†è¡¨)
            return false;
        }

        function calculateCRS() {
            var isSingle = getIsSingle();
            
            // --- A. å¹´é¾„ç®—åˆ† (å•èº« vs å·²å©š) ---
            var ageIdx = parseInt(document.getElementById('age').value || 0);
            // å•èº«è¡¨ (æœ€é«˜110) vs å·²å©šè¡¨ (æœ€é«˜100)
            var ageMapSingle = {12:110, 11:105, 10:99, 9:94, 8:88, 7:83, 6:77, 5:72, 4:66, 3:61, 2:55, 1:45, 0:0};
            var ageMapMarried = {12:100, 11:95, 10:90, 9:85, 8:80, 7:75, 6:70, 5:65, 4:60, 3:55, 2:50, 1:40, 0:0};
            
            var ageScore = isSingle ? (ageMapSingle[ageIdx]||0) : (ageMapMarried[ageIdx]||0);

            // --- B. å­¦å†ç®—åˆ† (å•èº« vs å·²å©š) ---
            var eduVal = document.getElementById('education').value;
            // å•èº«æœ€é«˜150, å·²å©šæœ€é«˜140
            var eduPoints = {
                "phd": [150, 140], "master": [135, 126], "two-certs": [128, 119],
                "bachelor": [120, 112], "2yr": [98, 91], "1yr": [90, 84], "hs": [30, 28]
            };
            var eduScore = 0;
            if(eduPoints[eduVal]) {
                eduScore = isSingle ? eduPoints[eduVal][0] : eduPoints[eduVal][1];
            }

            // --- C. è¯­è¨€ç®—åˆ† (å•èº« vs å·²å©š) ---
            // å•èº«å•é¡¹æœ€é«˜34, å·²å©šå•é¡¹æœ€é«˜32
            var l = parseFloat(document.getElementById('ielts-l').value)||0;
            var r = parseFloat(document.getElementById('ielts-r').value)||0;
            var w = parseFloat(document.getElementById('ielts-w').value)||0;
            var s = parseFloat(document.getElementById('ielts-s').value)||0;
            // ç¦æ­¢è´Ÿæ•°
            l=l<0?0:l; r=r<0?0:r; w=w<0?0:w; s=s<0?0:s;

            function getLangScore(clb) {
                if(isSingle) { // Max 34
                    if(clb>=10) return 34; if(clb==9) return 31; if(clb==8) return 23; if(clb==7) return 17; return 0;
                } else { // Max 32 (Married)
                    if(clb>=10) return 32; if(clb==9) return 29; if(clb==8) return 22; if(clb==7) return 16; return 0;
                }
            }
            // è¾…åŠ©ï¼šIELTSè½¬CLB
            function toCLB(t, v){
                if(t=='L'){ if(v>=8.5)return 10;if(v>=8)return 9;if(v>=7.5)return 8;if(v>=6)return 7;return 5;}
                if(t=='R'){ if(v>=8)return 10;if(v>=7)return 9;if(v>=6.5)return 8;if(v>=6)return 7;return 5;}
                if(t=='W'||t=='S'){ if(v>=7.5)return 10;if(v>=7)return 9;if(v>=6.5)return 8;if(v>=6)return 7;return 5;}
                return 0;
            }
            
            var clbL = toCLB('L',l); var clbR = toCLB('R',r); var clbW = toCLB('W',w); var clbS = toCLB('S',s);
            var langScore = getLangScore(clbL) + getLangScore(clbR) + getLangScore(clbW) + getLangScore(clbS);

            // --- D. å·¥ä½œç»éªŒ (Transferability - äº¤å‰é¡¹) ---
            // æ³¨æ„ï¼šäº¤å‰é¡¹è§„åˆ™å¯¹å•èº«/å·²å©šæ˜¯ä¸€æ ·çš„ (éƒ½æ˜¯æœ€é«˜50æˆ–25ç­‰)ï¼Œä¸éœ€è¦åŒºåˆ†
            var canExp = parseInt(document.getElementById('can-exp').value||0);
            var forExp = parseInt(document.getElementById('foreign-exp').value||0);
            
            // ç®€å•å¤„ç†åŠ æ‹¿å¤§å·¥ä½œåˆ† (åŸºç¡€åˆ†)
            // å•èº«æœ€é«˜80, å·²å©šæœ€é«˜70
            var canWorkBase = 0;
            var cwMapS = {0:0, 1:40, 2:53, 3:64, 4:72, 5:80};
            var cwMapM = {0:0, 1:35, 2:46, 3:56, 4:63, 5:70};
            canWorkBase = isSingle ? (cwMapS[canExp]||80) : (cwMapM[canExp]||70);

            // æ ¸å¿ƒåˆ†æ±‡æ€»
            var core = ageScore + eduScore + langScore + canWorkBase;

            // --- E. äº¤å‰é¡¹è®¡ç®— (Skill Transferability) ---
            // è¿™é‡Œçš„è§„åˆ™é€šç”¨ï¼Œä¸éœ€è¦åŒºåˆ†å•èº«å·²å©š
            var transfer = 0;
            var allCLB9 = (clbL>=9 && clbR>=9 && clbW>=9 && clbS>=9);
            var allCLB7 = (clbL>=7 && clbR>=7 && clbW>=7 && clbS>=7);
            var highEdu = (eduVal=='phd'||eduVal=='master'||eduVal=='two-certs'); // åŒå­¦å†åŠä»¥ä¸Š

            // 1. å­¦å†+è¯­è¨€
            if(highEdu && allCLB9) transfer+=50; 
            else if(highEdu && allCLB7) transfer+=25;
            else if(!highEdu && allCLB9) transfer+=25;
            else if(!highEdu && allCLB7) transfer+=13;

            // 2. å­¦å†+åŠ æ‹¿å¤§å·¥ä½œ (2å¹´ä»¥ä¸Š=High, 1å¹´=Mid)
            var highCW = (canExp>=2); var midCW = (canExp==1);
            if(highEdu && highCW) transfer+=50;
            else if(highEdu && midCW) transfer+=25;
            else if(!highEdu && highCW) transfer+=25;
            else if(!highEdu && midCW) transfer+=13;
            
            if(transfer>50) transfer=50; // Cap at 50

            // 3. æµ·å¤–å·¥ä½œ+è¯­è¨€
            var foreignPoints = 0;
            if(forExp>=3 && allCLB9) foreignPoints+=50;
            else if(forExp>=3 && allCLB7) foreignPoints+=25;
            else if(forExp>=1 && allCLB9) foreignPoints+=25;
            else if(forExp>=1 && allCLB7) foreignPoints+=13;

            // 4. æµ·å¤–å·¥ä½œ+åŠ æ‹¿å¤§å·¥ä½œ
            if(forExp>=3 && highCW) foreignPoints+=50;
            else if(forExp>=3 && midCW) foreignPoints+=25;
            else if(forExp>=1 && highCW) foreignPoints+=25;
            else if(forExp>=1 && midCW) foreignPoints+=13;

            if(foreignPoints>50) foreignPoints=50;
            
            var totalTransfer = transfer + foreignPoints;
            if(totalTransfer>100) totalTransfer=100;

            var total = core + totalTransfer;

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('total-score').innerText = total;
            
            // çŠ¶æ€æç¤º
            document.getElementById('status-display').innerText = isSingle ? 
                "(å½“å‰æŒ‰ï¼šå•èº«/é…å¶æ˜¯å…¬æ°‘ æ ‡å‡†è®¡ç®—)" : 
                "(å½“å‰æŒ‰ï¼šå·²å©šä¸”é…å¶éšè¡Œ æ ‡å‡†è®¡ç®— - ä¸»ç”³éƒ¨åˆ†)";
            
            // å»ºè®®æ–‡æ¡ˆ
            var advice = "";
            if(total>=500) advice="ğŸš€ åˆ†æ•°æé«˜ï¼å‡ ä¹é”å®šè·é‚€ã€‚";
            else if(total>=450) advice="âœ¨ å¾ˆæœ‰å¸Œæœ›ï¼å»ºè®®åˆ·é«˜é›…æ€æˆ–è€ƒè™‘çœæåã€‚";
            else advice="ğŸ“ˆ å»ºè®®è”ç³»æˆ‘ä»¬è§„åˆ’ LMIA å·¥ç­¾æˆ–ç•™å­¦åŠ åˆ†ã€‚";
            document.getElementById('score-advice').innerText = advice;
        }
    </script>
</body>
</html>
